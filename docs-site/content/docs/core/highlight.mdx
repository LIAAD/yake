<<<<<<< Updated upstream

=======
---
title: "TextHighlighter"
description: "Module for highlighting text based on keywords in YAKE"
---
>>>>>>> Stashed changes

import { Accordion, AccordionContent, AccordionItem, AccordionTrigger } from '@/components/ui/accordion'

# TextHighlighter

The `TextHighlighter` module provides functionality to highlight specific keywords in text, supporting both single-word and multi-word highlighting with customizable markers.

> **Info:** This documentation provides interactive code views for each method. Click on a function name to view its implementation.

## Module Overview

```python
"""
Module for highlighting text based on keywords.
Provides functionality to highlight specific keywords in text.
"""

import re
import logging
from dataclasses import dataclass
from typing import List

DEFAULT_HIGHLIGHT_PRE = "<kw>"
DEFAULT_HIGHLIGHT_POST = "</kw>"
```

## Class Definitions

### NgramData

<Accordion type="single" collapsible>
  <AccordionItem value="ngram_data">
    <AccordionTrigger>
      <code>NgramData</code>
    </AccordionTrigger>
    <AccordionContent>
      ```python
      @dataclass
      class NgramData:
          """Data structure to hold n-gram processing results."""

          word_list: List[str]
          split_kw_list: List[List[str]]
      ```
    </AccordionContent>
  </AccordionItem>
</Accordion>

A data class to store n-gram processing results containing:
- `word_list`: List of extracted words
- `split_kw_list`: List of split keywords for processing

### TextHighlighter

<Accordion type="single" collapsible>
  <AccordionItem value="constructor">
    <AccordionTrigger>
      <code>__init__(max_ngram_size, highlight_pre=DEFAULT_HIGHLIGHT_PRE, highlight_post=DEFAULT_HIGHLIGHT_POST)</code>
    </AccordionTrigger>
    <AccordionContent>
      ```python
      def __init__(
          self,
          max_ngram_size,
          highlight_pre=DEFAULT_HIGHLIGHT_PRE,
          highlight_post=DEFAULT_HIGHLIGHT_POST,
      ):
          """
          TextHighlighter constructor. Define highlight text snippets.

          Args:
              max_ngram_size: Specifies the maximum ngram size in the keywords.
              highlight_pre: Specifies the text before a highlighted term. Defaults to <kw>.
              highlight_post: Specifies the text after a highlighted term. Defaults to </kw>.
          """
          self.highlight_pre = highlight_pre
          self.highlight_post = highlight_post
          self.max_ngram_size = max_ngram_size
      ```
    </AccordionContent>
  </AccordionItem>
</Accordion>

**Parameters:**
- `max_ngram_size` (int): Maximum size of n-grams to consider for highlighting
- `highlight_pre` (str, optional): Text to insert before highlighted terms (default: `<kw>`)
- `highlight_post` (str, optional): Text to insert after highlighted terms (default: `</kw>`)

## Core Methods

<Accordion type="single" collapsible>
  <AccordionItem value="highlight">
    <AccordionTrigger>
      <code>highlight(text, keywords)</code>
    </AccordionTrigger>
    <AccordionContent>
      ```python
      def highlight(self, text, keywords):
          """
          Highlights keywords in the given text.

          Args:
              text: The original text to be processed.
              keywords: A list of keywords to highlight.
                       Each keyword can be a string or a tuple where the first element is the keyword.

          Returns:
              The text with highlighted keywords.
          """
          n_text = ""
          if len(keywords) > 0:
              kw_list = keywords
              if isinstance(keywords[0], tuple):
                  kw_list = [x[0] for x in keywords]
              text = text.strip()
              if self.max_ngram_size == 1:
                  n_text = self.format_one_gram_text(text, kw_list)
              else:
                  n_text = self.format_n_gram_text(text, kw_list)
          return n_text
      ```
    </AccordionContent>
  </AccordionItem>

  <AccordionItem value="format_one_gram">
    <AccordionTrigger>
      <code>format_one_gram_text(text, relevant_words_array)</code>
    </AccordionTrigger>
    <AccordionContent>
      ```python
      def format_one_gram_text(self, text, relevant_words_array):
          """
          Formats text for one-gram highlighting.

          Args:
              text: The text to process
              relevant_words_array: Keywords to highlight

          Returns:
              Formatted text with highlighted keywords
          """
          text_tokens = text.replace("\n", " ").split(" ")
          relevant_words_array = [kw.lower() for kw in relevant_words_array]
          try:
              for tk, token in enumerate(text_tokens):
                  kw = re.sub(r'[!",:.;?()]$|^[!",:.;?()]|\W[!",:.;?()]', "", token)
                  if kw.lower() in relevant_words_array:
                      text_tokens[tk] = token.replace(
                          kw, f"{self.highlight_pre}{kw}{self.highlight_post}"
                      )
          except re.error as e:
              logging.error("Regex error: %s", e)
          return " ".join(text_tokens)
      ```
    </AccordionContent>
  </AccordionItem>

  <AccordionItem value="format_n_gram">
    <AccordionTrigger>
      <code>format_n_gram_text(text, relevant_words_array)</code>
    </AccordionTrigger>
    <AccordionContent>
      ```python
      def format_n_gram_text(self, text, relevant_words_array):
          """
          Formats text for n-gram highlighting.

          Args:
              text: The text to process
              relevant_words_array: Keywords to highlight

          Returns:
              Formatted text with highlighted keywords
          """
          text_tokens = text.replace("\n", " ").split(" ")
          relevant_words_array = [kw.lower() for kw in relevant_words_array]

          y = 0
          final_splited_text = []

          while y < len(text_tokens):
              n_gram_data = self.find_relevant_ngrams(
                  y, text_tokens, relevant_words_array
              )

              n_gram_word_list, splited_n_gram_kw_list = n_gram_data

              if n_gram_word_list:
                  context = {
                      "splited_n_gram_kw_list": splited_n_gram_kw_list,
                      "relevant_words_array": relevant_words_array,
                      "final_splited_text": final_splited_text,
                  }
                  y, new_expression = self.process_ngrams(
                      text_tokens, y, n_gram_word_list, context
                  )
                  final_splited_text.append(new_expression)
              else:
                  final_splited_text.append(text_tokens[y])
                  y += 1

          return " ".join(final_splited_text)
      ```
    </AccordionContent>
  </AccordionItem>

  <AccordionItem value="find_relevant_ngrams">
    <AccordionTrigger>
      <code>find_relevant_ngrams(position, text_tokens, relevant_words_array)</code>
    </AccordionTrigger>
    <AccordionContent>
      ```python
      def find_relevant_ngrams(self, position, text_tokens, relevant_words_array):
          """
          Finds relevant n-grams in the text.

          Args:
              position: Current position in text tokens
              text_tokens: List of tokens from the text
              relevant_words_array: Keywords to highlight

          Returns:
              Tuple containing n-gram word list and split n-gram keyword list
          """

          ngram_data = self._find_more_relevant_helper(
              position, text_tokens, relevant_words_array
          )

          return ngram_data
      ```
    </AccordionContent>
  </AccordionItem>
  
  <AccordionItem value="process_ngrams">
    <AccordionTrigger>
      <code>process_ngrams(text_tokens, position, n_gram_word_list, context)</code>
    </AccordionTrigger>
    <AccordionContent>
      ```python
      def process_ngrams(self, text_tokens, position, n_gram_word_list, context):
          """
          Processes n-grams and updates the final text.

          Args:
              text_tokens: List of tokens from the text
              position: Current position in text tokens
              n_gram_word_list: List of n-gram words
              context: Dictionary containing split n-gram keywords,
                  relevant words array, and final split text

          Returns:
              Tuple containing new position and new expression
          """
          if len(n_gram_word_list[0].split(" ")) == 1:
              position, new_expression = self.replace_token(
                  text_tokens, position, n_gram_word_list
              )
          else:
              ctx = self._create_ngram_context(
                  n_gram_word_list,
                  context["splited_n_gram_kw_list"],
                  context["relevant_words_array"],
                  context["final_splited_text"],
              )
              position, new_expression = self._process_multi_word_ngrams_helper(
                  text_tokens, position, ctx
              )

          return position, new_expression
      ```
    </AccordionContent>
  </AccordionItem>
  
  <AccordionItem value="replace_token">
    <AccordionTrigger>
      <code>replace_token(text_tokens, position, n_gram_word_list)</code>
    </AccordionTrigger>
    <AccordionContent>
      ```python
      def replace_token(self, text_tokens, position, n_gram_word_list):
          """
          Replaces tokens in text with highlighted versions.

          Args:
              text_tokens: List of tokens from the text
              position: Current position in text tokens
              n_gram_word_list: List of n-gram words

          Returns:
              Tuple containing new position and new expression
          """
          if not n_gram_word_list:
              return position + 1, text_tokens[position]

          num_tokens = len(n_gram_word_list[0].split(" "))

          if position + num_tokens > len(text_tokens):
              num_tokens = len(text_tokens) - position

          txt = " ".join(text_tokens[position : position + num_tokens])
          kw_cleaned = re.sub(r'[!",:.;?()]$|^[!",:.;?()]|\W[!",:.;?()]', "", txt)
          new_expression = txt.replace(
              kw_cleaned,
              f"{self.highlight_pre}{n_gram_word_list[0]}{self.highlight_post}",
          )

          return position + num_tokens, new_expression
      ```
    </AccordionContent>
  </AccordionItem>
</Accordion>

## Helper Methods

<Accordion type="single" collapsible>
  <AccordionItem value="find_more_relevant_helper">
    <AccordionTrigger>
      <code>_find_more_relevant_helper(position, text_tokens, relevant_words_array)</code>
    </AccordionTrigger>
    <AccordionContent>
      ```python
      def _find_more_relevant_helper(self, position, text_tokens, relevant_words_array):
          """
          Helper method for finding relevant n-gram words.

          Args:
              position: Current position in text tokens
              text_tokens: List of tokens from the text
              relevant_words_array: Keywords to highlight

          Returns:
              NgramData containing keyword list and split n-gram word list
          """
          temporary_list = []
          temporary_list_two = []
          kw_list = []
          splited_n_gram_word_list = []

          for i in range(self.max_ngram_size):
              if position + i < len(text_tokens):
                  temporary_list.append(text_tokens[position : position + i + 1])
                  k = re.sub(
                      r'[!",:.;?()]$|^[!",:.;?()]|\W[!",:.;?()]',
                      "",
                      " ".join(temporary_list[i]),
                  )
                  if k.lower() in relevant_words_array:
                      temporary_list_two.append(k)

          if temporary_list_two:
              sorted_temp = sorted(
                  temporary_list_two, key=lambda x: relevant_words_array.index(x.lower())
              )
              kw_list.append(sorted_temp[0])
              splited_n_gram_word_list.append(kw_list[0].split())

          return kw_list, splited_n_gram_word_list
      ```
    </AccordionContent>
  </AccordionItem>
  
  <AccordionItem value="create_ngram_context">
    <AccordionTrigger>
      <code>_create_ngram_context(n_gram_word_list, splited_n_gram_kw_list, relevant_words_array, final_splited_text)</code>
    </AccordionTrigger>
    <AccordionContent>
      ```python
      def _create_ngram_context(
          self,
          n_gram_word_list,
          splited_n_gram_kw_list,
          relevant_words_array,
          final_splited_text,
      ):
          """
          Creates a context object for n-gram processing.

          Args:
              position: Current position in text tokens
              n_gram_word_list: List of n-gram words
              splited_n_gram_kw_list: List of split n-gram keywords
              relevant_words_array: Keywords to highlight
              final_splited_text: List of processed text tokens

          Returns:
              Dictionary with context information
          """
          return {
              "n_gram_word_list": n_gram_word_list,
              "splited_n_gram_kw_list": splited_n_gram_kw_list,
              "relevant_words_array": relevant_words_array,
              "final_splited_text": final_splited_text,
          }
      ```
    </AccordionContent>
  </AccordionItem>
</Accordion>

## Usage Example

```python
from yake.highlight import TextHighlighter

# Sample text to process
text = "Natural language processing is a field of artificial intelligence that focuses on interactions between computers and human language."

# Keywords to highlight
keywords = ["natural language processing", "artificial intelligence", "computers"]

# Initialize the highlighter with maximum n-gram size of 3
highlighter = TextHighlighter(max_ngram_size=3)

# Get highlighted text
highlighted_text = highlighter.highlight(text, keywords)
print(highlighted_text)
# Output: "<kw>Natural language processing</kw> is a field of <kw>artificial intelligence</kw> that focuses on interactions between <kw>computers</kw> and human language."

# Custom highlighting markers
custom_highlighter = TextHighlighter(
    max_ngram_size=3,
    highlight_pre="**",
    highlight_post="**"
)
custom_highlighted = custom_highlighter.highlight(text, keywords)
print(custom_highlighted)
# Output: "**Natural language processing** is a field of **artificial intelligence** that focuses on interactions between **computers** and human language."
```

## Dependencies

The `TextHighlighter` module relies on:
- `re`: For regular expression operations in text processing
- `logging`: For error handling and reporting
- `dataclasses`: For defining the `NgramData` dataclass
- `typing`: For type annotations